name: Build & Release Optimizer EXE

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch: # allows manual run

jobs:
  build:
    runs-on: windows-latest

    steps:
      # 1) Checkout repo
      - uses: actions/checkout@v4

      # 2) Setup MSBuild
      - uses: microsoft/setup-msbuild@v2

      # 3) Setup NuGet
      - uses: nuget/setup-nuget@v1

      # 4) Restore NuGet packages
      - run: nuget restore Optimizer.slnx

      # 5) Build EXE
      - run: msbuild Optimizer.slnx /p:Configuration=Release /p:Platform="Any CPU"

      # 6) Create release ONLY if triggered by a tag
      - name: Create GitHub Release
        if: github.ref_type == 'tag'
        uses: softprops/action-gh-release@v2
        with:
          files: Optimizer/**/bin/Release/*.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
